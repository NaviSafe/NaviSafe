services:
  # subway-api:
  #   build:
  #     context: ../dataflow
  #   container_name: transit
  #   environment:
  #     SEOUL_SUBWAY_ARRIVAL_API_KEY: ${SEOUL_SUBWAY_ARRIVAL_API_KEY}
  #     SEOUL_TRANSIT_API_KEY: ${SEOUL_TRANSIT_API_KEY}
  #   volumes:
  #     - ../dataflow/app.py:/app/app.py       # 로컬 app.py → 컨테이너 /app/app.py
  #   working_dir: /app
  #   ports:
  #     - "5000:5000"               # Flask API 외부 노출
  #   command: python3 app.py
  #   restart: unless-stopped

  nginx:
    image: nginx:latest
    container_name: navisafe-nginx
    ports:
      - "80:80"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
    depends_on:
      - backend-1
      - backend-2
    networks:
      - data-platform

  # frontend:
  #   build:
  #     context: ../naviSafe-frontend
  #     dockerfile: Dockerfile
  #   container_name: frontend
  #   ports:
  #     - "5173:5173"
  #   environment:
  #     - NODE_ENV=development
  #   volumes:
  #     - ../naviSafe-frontend:/app
  #     - /app/node_modules
  #   command: npm run dev
  #   depends_on:
  #     - nginx
  #   networks:
  #     - data-platform

  frontend-1:
    build:
      context: ../naviSafe-frontend
      dockerfile: Dockerfile
    container_name: frontend-1
    expose:
      - "80"
    networks:
      - data-platform

  frontend-2:
    build:
      context: ../naviSafe-frontend
      dockerfile: Dockerfile
    container_name: frontend-2
    expose:
      - "80"
    networks:
      - data-platform
        
  backend-1:
    build:
      context: ../naviSafe-backend
      dockerfile: Dockerfile
    container_name: backend-1
    expose:
      - "8080"
    command: java -jar app.jar
    networks:
      - data-platform

  backend-2:
    build:
      context: ../naviSafe-backend
      dockerfile: Dockerfile
    container_name: backend-2
    expose:
      - "8080"
    command: java -jar app.jar
    networks:
      - data-platform


networks:
  data-platform:
    external: true
